{"version":3,"file":"engine-loader.js","sources":["../../src/services/engine-loader.ts"],"sourcesContent":["import Service from '@ember/service';\nimport { getOwner } from '@ember/owner';\n\nimport type Owner from '@ember/owner';\n\ntype ExtendedOwner = Owner & {\n  hasRegistration(name: string): boolean;\n};\n\nexport default class EngineLoaderService extends Service {\n  /**\n   * Checks the owner to see if it has a registration for an Engine. This is a\n   * proxy to tell if an Engine's assets are loaded or not.\n   *\n   * @see https://github.com/ember-engines/ember-engines/blob/8f66b5e3b8089cd53884be49f270cac05f9a3d17/addon/-private/router-ext.js#L152-L164\n   *\n   * @param {String} name\n   * @return {Boolean}\n   */\n  isLoaded(name: string) {\n    const owner = <ExtendedOwner>getOwner(this);\n    return Boolean(owner?.hasRegistration(`engine:${name}`));\n  }\n\n  /**\n   * Registers an Engine that was recently loaded.\n   *\n   * @see https://github.com/ember-engines/ember-engines/blob/8f66b5e3b8089cd53884be49f270cac05f9a3d17/addon/-private/router-ext.js#L166-L182\n   *\n   * @param {String} name\n   */\n  register(name: string) {\n    if (this.isLoaded(name)) return;\n\n    const owner = getOwner(this);\n    owner?.register(\n      `engine:${name}`,\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      globalThis.require(`${name}/engine`).default,\n    );\n  }\n\n  /**\n   * Loads and registers a lazy Engine.\n   *\n   * @param {String} name\n   * @async\n   */\n  async load(name: string) {\n    if (this.isLoaded(name)) return;\n\n    const assetLoader = getOwner(this)?.lookup('service:asset-loader');\n    await assetLoader?.loadBundle(name);\n    this.register(name);\n  }\n}\n"],"names":["EngineLoaderService","Service","isLoaded","name","owner","getOwner","Boolean","hasRegistration","register","globalThis","require","default","load","assetLoader","lookup","loadBundle"],"mappings":";;;AASe,MAAMA,mBAAmB,SAASC,OAAO,CAAC;AACvD;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEC,QAAQA,CAACC,IAAY,EAAE;AACrB,IAAA,MAAMC,KAAK,GAAkBC,QAAQ,CAAC,IAAI,CAAC,CAAA;IAC3C,OAAOC,OAAO,CAACF,KAAK,EAAEG,eAAe,CAAC,CAAUJ,OAAAA,EAAAA,IAAI,CAAE,CAAA,CAAC,CAAC,CAAA;AAC1D,GAAA;;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;EACEK,QAAQA,CAACL,IAAY,EAAE;AACrB,IAAA,IAAI,IAAI,CAACD,QAAQ,CAACC,IAAI,CAAC,EAAE,OAAA;AAEzB,IAAA,MAAMC,KAAK,GAAGC,QAAQ,CAAC,IAAI,CAAC,CAAA;AAC5BD,IAAAA,KAAK,EAAEI,QAAQ,CACb,CAAA,OAAA,EAAUL,IAAI,CAAE,CAAA;AAChB;AACA;IACAM,UAAU,CAACC,OAAO,CAAC,CAAA,EAAGP,IAAI,CAAS,OAAA,CAAA,CAAC,CAACQ,OACvC,CAAC,CAAA;AACH,GAAA;;AAEA;AACF;AACA;AACA;AACA;AACA;EACE,MAAMC,IAAIA,CAACT,IAAY,EAAE;AACvB,IAAA,IAAI,IAAI,CAACD,QAAQ,CAACC,IAAI,CAAC,EAAE,OAAA;IAEzB,MAAMU,WAAW,GAAGR,QAAQ,CAAC,IAAI,CAAC,EAAES,MAAM,CAAC,sBAAsB,CAAC,CAAA;AAClE,IAAA,MAAMD,WAAW,EAAEE,UAAU,CAACZ,IAAI,CAAC,CAAA;AACnC,IAAA,IAAI,CAACK,QAAQ,CAACL,IAAI,CAAC,CAAA;AACrB,GAAA;AACF;;;;"}